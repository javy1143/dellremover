# ==============================================================================
# MASTER DELL BLOATWARE REMOVAL SCRIPT v4.0 (GHOST HUNTER)
# TARGETS: Stubborn Control Panel entries and leftover Start Menu shortcuts.
# ==============================================================================

$ErrorActionPreference = "SilentlyContinue"

# 1. DEFINE TARGETS (Control Panel names)
$Targets = @(
    "Dell Pair", "Dell CinemaColor", "SupportAssist", 
    "Dell Digital Delivery", "Dell Customer Connect", "My Dell", "Fusion Service"
)

# 2. CLEAR CONTROL PANEL "GHOST" ENTRIES (Registry Nuke)
Write-Host "--- Clearing Control Panel Ghost Entries ---" -ForegroundColor Cyan
$RegPaths = @(
    "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall",
    "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall",
    "HKCU:\Software\Microsoft\Windows\CurrentVersion\Uninstall"
)

foreach ($Path in $RegPaths) {
    if (Test-Path $Path) {
        Get-ChildItem -Path $Path | ForEach-Object {
            $Key = $_
            $DisplayName = (Get-ItemProperty -Path $Key.PSPath).DisplayName
            
            foreach ($Target in $Targets) {
                if ($DisplayName -like "*$Target*") {
                    Write-Host "Removing Registry Entry: $DisplayName" -ForegroundColor Yellow
                    Remove-Item -Path $Key.PSPath -Recurse -Force
                }
            }
        }
    }
}

# 3. DELETE START MENU SHORTCUTS
Write-Host "--- Cleaning Start Menu Shortcuts ---" -ForegroundColor Cyan
$ShortcutPaths = @(
    "$env:ProgramData\Microsoft\Windows\Start Menu\Programs",
    "$env:AppData\Microsoft\Windows\Start Menu\Programs"
)

foreach ($SPath in $ShortcutPaths) {
    if (Test-Path $SPath) {
        # Find any shortcuts with "Dell" or "CinemaColor" or "Pair" in the name
        Get-ChildItem -Path $SPath -Recurse -Include "*.lnk", "*.url" | Where-Object {
            $_.Name -like "*Dell*" -or $_.Name -like "*CinemaColor*" -or $_.Name -like "*Pair*"
        } | ForEach-Object {
            Write-Host "Deleting Shortcut: $($_.FullName)" -ForegroundColor Red
            Remove-Item -Path $_.FullName -Force
        }
        
        # Also check for Dell-specific folders in the Start Menu
        Get-ChildItem -Path $SPath -Directory | Where-Object { $_.Name -like "*Dell*" } | ForEach-Object {
            Write-Host "Deleting Folder: $($_.FullName)" -ForegroundColor Red
            Remove-Item -Path $_.FullName -Recurse -Force
        }
    }
}

# 4. RESET THE START MENU CACHE (Forces Windows to refresh the icons)
Write-Host "--- Refreshing Explorer Cache ---" -ForegroundColor Cyan
Stop-Process -Name explorer -Force
Start-Sleep -Seconds 2
Start-Process explorer

Write-Host "Ghost entries and shortcuts cleared." -ForegroundColor Green
